) %>%
group_by(GEOID, NAME, total_popE, total_popM, med_HH_incomeE, med_HH_incomeM) %>%
summarise(
sum_over65 = sum(age_vars, na.rm = TRUE),
.groups = "drop"
)
data <- get_acs(
geography = "state",
variables = c(male_under5 = "B01001_003",
female_under5 = "B01001_027"),
year = 2022,
survey = "acs5"
) %>%
group_by(GEOID, NAME) %>%
summarise(
total_under5 = sum(estimate, na.rm = TRUE),
.groups = "drop"
)
View(data)
data <- get_acs(
geography = "state",
variables = c(male_under5 = "B01001_003",
female_under5 = "B01001_027"),
year = 2022,
survey = "acs5"
)
View(data)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022
) %>%
group_by(GEOID, NAME, total_popE, total_popM, med_HH_incomeE, med_HH_incomeM) %>%
summarise(
sum_over65E = sum(estimates, na.rm = TRUE),
sum_over65M = sum(moe, na.rm = TRUE)
.groups = "drop"
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022
) %>%
group_by(GEOID, NAME, total_popE, total_popM, med_HH_incomeE, med_HH_incomeM) %>%
summarise(
sum_over65E = sum(estimates, na.rm = TRUE),
sum_over65M = sum(moe, na.rm = TRUE),
.groups = "drop"
)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022
)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide")
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769EM,m_7074EM,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
View(census_tracts)
View(demo_data)
demo_data <- demo_data %>%
mutate(NAME = str_extract(NAME, "Census Tract [0-9.]+"))
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
demo_data <- demo_data %>%
mutate(NAME = str_extract(NAME, "Census Tract [0-9.]+"))
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM)) %>%
mutate(NAME = str_extract(NAME, "Census Tract [0-9.]+"))
st_crs(demo_data)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
View(census_tracts)
# Join to tract boundaries
tracts_demodata <- census_tracts %>%
left_join(demo_data, by = "GEOID")
View(tracts_demodata)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE)
# Join to tract boundaries
tracts_demodata <- census_tracts %>%
left_join(demo_data %>% select(total_popE, total_popM, med_HH_incomeE, med_HH_incomeM, over65E),
by = "GEOID")
# Join to tract boundaries
tracts_demodata <- census_tracts %>%
left_join(demo_data %>% select(total_popE, total_popM, med_HH_incomeE, med_HH_incomeM, over_65E),
by = "GEOID")
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
# Join to tract boundaries
# tracts_demodata <- census_tracts %>%
#   left_join(demo_data %>% select(total_popE, total_popM, med_HH_incomeE, med_HH_incomeM, over_65E),
#             by = "GEOID")
tracts_demodata <- census_tracts %>%
left_join(demo_data,
by = "GEOID")
View(tracts_demodata)
# Join to tract boundaries
# tracts_demodata <- census_tracts %>%
#   left_join(demo_data %>% select(total_popE, total_popM, med_HH_incomeE, med_HH_incomeM, over_65E),
#             by = "GEOID")
tracts_demodata <- census_tracts %>%
left_join(demo_data %>% select(-c(NAME, GEOID)),
by = "GEOID")
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
census_tracts
# Join to tract boundaries
# tracts_demodata <- census_tracts %>%
#   left_join(demo_data %>% select(total_popE, total_popM, med_HH_incomeE, med_HH_incomeM, over_65E),
#             by = "GEOID")
tracts_demodata <- census_tracts %>%
left_join(demo_data %>% select(-c(NAME, GEOID)),
by = "GEOID")
diff1 <- setdiff(demo_data$GEOID, census_tracts$GEOID)
diff1
diff1
demo_data <- demo_data[-diff1, ]
diff <- setdiff(demo_data$GEOID, census_tracts$GEOID)
demo_data <- demo_data[-diff, ]
demo_data <- demo_data[-'diff', ]
demo_data <- demo_data[-1524, ]
# Join to tract boundaries
# tracts_demodata <- census_tracts %>%
#   left_join(demo_data %>% select(total_popE, total_popM, med_HH_incomeE, med_HH_incomeM, over_65E),
#             by = "GEOID")
tracts_demodata <- census_tracts %>%
left_join(demo_data %>% select(-c(NAME, GEOID)),
by = "GEOID")
# Join to tract boundaries
# tracts_demodata <- census_tracts %>%
#   left_join(demo_data %>% select(total_popE, total_popM, med_HH_incomeE, med_HH_incomeM, over_65E),
#             by = "GEOID")
tracts_demodata <- census_tracts %>%
left_join(demo_data %>% select(-c(NAME)),
by = "GEOID")
missing_income <- tracts_demodata %>%
count(is.na(med_HH_incomeE))
missing_income <- tracts_demodata %>%
count(is.na(med_HH_incomeE))
missing_income
missing_income
View(missing_income)
missing_income <- tracts_demodata %>%
count(is.null(med_HH_incomeE))
View(missing_income)
missing_income <- tracts_demodata %>%
count(is.na(med_HH_incomeE))
View(missing_income)
missing_income_tracts <- tracts_demodata %>% filter(med_HH_incomeE == NA)
View(missing_income_tracts)
missing_income_tracts <- tracts_demodata %>% filter(is.na(med_HH_incomeE))
#how many tracts have missing income data
missing_income <- tracts_demodata %>%
count(is.na(med_HH_incomeE))
#how many tracts have missing income data
missing_income_count <- tracts_demodata %>%
count(is.na(med_HH_incomeE))
missing_income_count
View(missing_income_count)
o
missing_income_tracts <- tracts_demodata %>% filter(is.na(med_HH_incomeE))
View(missing_income_tracts)
diff
#wasn't joining because there was one census tract difference --> check what's in demo_data but not
#census_tracts --> one census with total pop of 0 --> get rid of and then join again
diff <- setdiff(demo_data$GEOID, census_tracts$GEOID)
demo_data <- demo_data[-demo_data[GEOID]==diff]
View(demo_data)
diff_row = demo_data.index[demo_data['GEOID'] == diff].tolist()
#wasn't joining because there was one census tract difference --> check what's in demo_data but not
#census_tracts --> one census with total pop of 0 --> get rid of and then join again
diff <- setdiff(demo_data$GEOID, census_tracts$GEOID)
# Get demographic data from ACS
acs_vars_2022 <- load_variables(2022, "acs5", cache = TRUE)
acs_vars <- c(
total_pop = "B01003_001",
med_HH_income = "B19013_001",
m_6566 = "B01001_020",
m_6769 = "B01001_021",
m_7074 = "B01001_022",
m_7579 = "B01001_023",
m_8084 = "B01001_024",
m_85over = "B01001_025",
f_6566 = "B01001_044",
f_6769 = "B01001_045",
f_7074 = "B01001_046",
f_7579 = "B01001_047",
f_8084 = "B01001_048",
f_85over = "B01001_049"
)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
diff_row = demo_data.index[demo_data['GEOID'] == diff].tolist()
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
atial data
pa_counties <- st_read(here("labs/lab_2/data/Pennsylvania_County_Boundaries.shp"))
hospitals <- st_read(here("labs/lab_2/data/hospitals.geojson"))
census_tracts <- tracts(state = "PA", cb = TRUE)
# Check that all data loaded correctly
# check crs
st_crs(pa_counties)
st_crs(hospitals)
st_crs(census_tracts)
# standardize crs
pa_counties <- st_transform(pa_counties, st_crs(hospitals))
census_tracts <- st_transform(census_tracts, st_crs(hospitals))
# Get demographic data from ACS
acs_vars_2022 <- load_variables(2022, "acs5", cache = TRUE)
acs_vars <- c(
total_pop = "B01003_001",
med_HH_income = "B19013_001",
m_6566 = "B01001_020",
m_6769 = "B01001_021",
m_7074 = "B01001_022",
m_7579 = "B01001_023",
m_8084 = "B01001_024",
m_85over = "B01001_025",
f_6566 = "B01001_044",
f_6769 = "B01001_045",
f_7074 = "B01001_046",
f_7579 = "B01001_047",
f_8084 = "B01001_048",
f_85over = "B01001_049"
)
demo_data <- get_acs(geography = "tract",
variables = acs_vars,
state = "PA", survey = "acs5", year = 2022, output = "wide"
) %>%
mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE
+f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%
select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,
f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,
m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,
f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))
#wasn't joining because there was one census tract difference --> check what's in demo_data but not
#census_tracts --> one census with total pop of 0 --> get rid of and then join again
diff <- setdiff(demo_data$GEOID, census_tracts$GEOID)
diff_row = demo_data.index[demo_data['GEOID'] == diff].tolist()
diff
diff_row = demo_data.index[demo_data['GEOID'] == diff]
#wasn't joining because there was one census tract difference --> check what's in demo_data but not
#census_tracts --> one census with total pop of 0 --> get rid of and then join again
demo_data = pd.DataFrame(demo_data)
diff_row = .indexdemo_data[demo_data['GEOID'] == diff].tolist()
diff_row = .index(demo_data[demo_data['GEOID'] == diff]).tolist()
diff_row = .index(demo_data[demo_data['GEOID'] == diff])
library(here)
library(xts)
install.packages(xts)
install.package(xts)
install.packages(xts)
install.packages("xts")
library(xts)
#wasn't joining because there was one census tract difference --> check what's in demo_data but not
#census_tracts --> one census with total pop of 0 --> get rid of and then join again
demo_data = pd.DataFrame(demo_data)
#wasn't joining because there was one census tract difference --> check what's in demo_data but not
#census_tracts --> one census with total pop of 0 --> get rid of and then join again
diff <- setdiff(demo_data$GEOID, census_tracts$GEOID)
diff_row = demo_data.index[demo_data['GEOID'] == diff].tolist()
diff_row = demo_data.index[['GEOID'] == diff].tolist()
diff_row = demo_data.index[demo_data["GEOID"] == diff].tolist()
diff_row = df.index[demo_data["GEOID"] == diff].tolist()
diff_row = demo_data.index[demo_data["GEOID"] == diff].tolist()
diff_row = .index[demo_data["GEOID"] == diff].tolist()
diff_row <- which(demo_data$GEOID == diff)
diff_row
demo_data <- demo_data[-demo_data["GEOID"]==diff_row]
diff_row <- which(demo_data$GEOID == diff)
demo_data <- demo_data[-demo_data["GEOID"]==diff_row]
demo_data <- demo_data[-diff_row,]
missing_inc_rows <- which(is.na(tracts_demodata$med_HH_incomeE))
avail_inc_data <- tracts_demodata[-missing_inc_rows,]
View(avail_inc_data)
#calculate mean of all median incomes
all_med_inc <- mean(avail_inc_data$med_HH_incomeE)
#calculate mean of all median incomes
all_med_inc <- mean(tracts_demodata$med_HH_incomeE, na.rm = TRUE)
#calculate mean of all median incomes
all_med_inc <- mean(tracts_demodata$med_HH_incomeE, na.rm = TRUE)
all_med_inc
#taking out rows with missing median income data
missing_inc_rows <- which(is.na(tracts_demodata$med_HH_incomeE))
avail_inc_data <- tracts_demodata[-missing_inc_rows,]
low_inc <- which(avail_inc_data$med_HH_incomeE < 60000)
low_inc <- avail_inc_data %>% filter(med_HH_incomeE < 60000)
View(low_inc)
# 2. adding column of percentage of elderly population --> chose ___ as sig
# elderly pop threshold
avail_inc_data <- avail_inc_data %>%
mutate(elderly_per = over_65E/total_popE*100)
View(avail_inc_data)
#filter out low income HHs
vul_pop <- avail_inc_data %>% filter(med_HH_incomeE < 60000 & elderly_per >= 17)
View(vul_pop)
#percent of PA CT that are vulnerable
PA_per_vul <- nrow(vul_pop)/nrow(census_tracts)
PA_per_vul
#percent of PA CT that are vulnerable
PA_per_vul <- nrow(vul_pop)/nrow(census_tracts)*100
PA_per_vul
# Transform to appropriate projected CRS
st_crs(vul_pop)
# Calculate distance from each tract centroid to nearest hospital
vul_tract_centroid <- st_centroid(vul_pop)
# Calculate distance from each tract centroid to nearest hospital
vul_tract_centroid <- st_centroid(vul_pop)
nearest_index <- st_nearest_feature(vul_tract_centroid, hospitals)
nearest_dist <- st_distance(vul_tract_centroid, hospitals[nearest_index,])
vul_pop$nearest_hosp <- nearest_dist
View(vul_pop)
vul_pop$nearest_hosp <- nearest_dist/1000
nearest_dist <- st_distance(vul_tract_centroid, hospitals[nearest_index,],
by_element = TRUE)
vul_pop$nearest_hosp <- nearest_dist/1000
View(vul_pop)
vul_pop$nearest_hosp <- as.numeric(nearest_dist/1000)
vul_pop$nearest_hosp <- as.numeric(nearest_dist)
vul_pop$nearest_hosp <- as.numeric(nearest_dist/1000)
# avg distance to hospitals for all vulnerable tracts
avg_hosp_dist <- vul_pop %>% mean(nearest_hosp)
avg_hosp_dist
# avg distance to hospitals for all vulnerable tracts
avg_hosp_dist <- vul_pop %>% mean(nearest_hosp, na.rm = TRUE)
avg_hosp_dist
# avg distance to hospitals for all vulnerable tracts
avg_hosp_dist <- vul_pop %>% mean(nearest_hosp, na.rm = TRUE)
vul_pop$nearest_hosp
# avg distance to hospitals for all vulnerable tracts
avg_hosp_dist <- mean(vul_pop$nearest_hosp, na.rm = TRUE)
avg_hosp_dist
# maximum distance
max_dist <- vul_pop %>% slice_max(nearest_hosp, n=1)
max_dist
vul_pop$nearest_hosp <- as.numeric(nearest_dist/1609.344) #make it in km's
View(vul_pop)
# avg distance to hospitals for all vulnerable tracts
avg_hosp_dist <- mean(vul_pop$nearest_hosp, na.rm = TRUE)
avg_hosp_dist
# maximum distance
max_dist <- vul_pop %>% slice_max(nearest_hosp, n=1)
max_dist
# >15 miles
more_15 <- vul_pop %>% filter(nearest_hosp > 15)
more_15
nrow(more_15)
# Create underserved variable
underserved <- more_15
underserved
View(underserved)
#per_underserved
per_und <- nrow(underserved)/nrow(vul_pop)*100
per_und
View(pa_counties)
# Spatial join tracts to counties
tracts_by_county <- vul_pop %>%
st_join(pa_counties %>% select(COUNTY_NAM)) %>%
st_drop_geometry() %>%
group_by(COUNTY_NAM) %>%
summarize(
n_tracts = n_distinct(GEOID),
tract_ids = paste(unique(MSLINK), collapse = ", ")
) %>%
arrange(desc(n_tracts))
# Spatial join tracts to counties
tracts_by_county <- vul_pop %>%
st_join(pa_counties %>% select(COUNTY_NAM)) %>%
st_drop_geometry() %>%
group_by(COUNTY_NAM) %>%
summarize(
n_tracts = n_distinct(GEOID),
tract_ids = paste(unique(NAMELSAD), collapse = ", ")
) %>%
arrange(desc(n_tracts))
View(tracts_by_county)
#add underserved status to vul_pop
underserved_rows <- vul_pop %>% which(nearest_hosp>15)
#add underserved status to vul_pop
underserved_rows <- which(vul_pop$nearest_hosp>15)
underserved_rows
#add underserved status to vul_pop
vul_pop <- vul_pop %>%
mutate(underserved = case_when(nearest_hosp > 15 ~ 'Underserved',
TRUE ~ 'Appropriately Served'))
# Spatial join tracts to counties
tracts_by_county <- vul_pop %>%
st_join(pa_counties %>% select(COUNTY_NAM)) %>%
st_drop_geometry() %>%
group_by(COUNTY_NAM) %>%
summarize(
n_tracts = n_distinct(GEOID),
tract_ids = paste(unique(NAMELSAD), collapse = ", "),
n_underserved = count(underserved = "Underserved")
) %>%
arrange(desc(n_tracts))
# Spatial join tracts to counties
tracts_by_county <- vul_pop %>%
st_join(pa_counties %>% select(COUNTY_NAM)) %>%
st_drop_geometry() %>%
group_by(COUNTY_NAM) %>%
summarize(
n_tracts = n_distinct(GEOID),
tract_ids = paste(unique(NAMELSAD), collapse = ", "),
n_underserved = sum(underserved = "Underserved")
) %>%
arrange(desc(n_tracts))
# Spatial join tracts to counties
tracts_by_county <- vul_pop %>%
st_join(pa_counties %>% select(COUNTY_NAM)) %>%
st_drop_geometry() %>%
group_by(COUNTY_NAM) %>%
summarize(
n_tracts = n_distinct(GEOID),
tract_ids = paste(unique(NAMELSAD), collapse = ", "),
n_underserved = sum(underserved == "Underserved")
) %>%
arrange(desc(n_tracts))
