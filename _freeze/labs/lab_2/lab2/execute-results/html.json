{
  "hash": "44d74bff734dfc0e4e460a377a6a0cf6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lab 2: Spatial Analysis and Visualization\"\nsubtitle: \"Healthcare Access and Equity in Pennsylvania\"\nauthor: \"Angie Kwon\"\ndate: today\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\n---\n\n## Assignment Overview\n\n**Learning Objectives:**\n- Apply spatial operations to answer policy-relevant research questions\n- Integrate census demographic data with spatial analysis\n- Create publication-quality visualizations and maps\n- Work with spatial data from multiple sources\n- Communicate findings effectively for policy audiences\n\n---\n\n## Part 1: Healthcare Access for Vulnerable Populations\n\n### Research Question\n\n**Which Pennsylvania counties have the highest proportion of vulnerable populations (elderly + low-income) living far from hospitals?**\n\nYour analysis should identify counties that should be priorities for healthcare investment and policy intervention.\n\n### Required Analysis Steps\n\nComplete the following analysis, documenting each step with code and brief explanations:\n\n#### Step 1: Data Collection (5 points)\n\nLoad the required spatial data:\n- Pennsylvania county boundaries\n- Pennsylvania hospitals (from lecture data)\n- Pennsylvania census tracts\n\n**Your Task:**\n\n::: {.cell}\n\n:::\n\n\n**Questions to answer:**\n- How many hospitals are in your dataset? **223**\n- How many census tracts? **3445**\n- What coordinate reference system is each dataset in? **WGS 84 / pseudo mercator, WGS 84, NAD --> standardized to hospital dataset's CRS which is WGS 84.**\n\n---\n\n#### Step 2: Get Demographic Data \n\nUse `tidycensus` to download tract-level demographic data for Pennsylvania.\n\n**Required variables:**\n- Total population\n- Median household income\n- Population 65 years and over (you may need to sum multiple age categories)\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get demographic data from ACS\nacs_vars_2022 <- load_variables(2022, \"acs5\", cache = TRUE)\nacs_vars <- c(\n  total_pop = \"B01003_001\",\n  med_HH_income = \"B19013_001\",\n  m_6566 = \"B01001_020\",\n  m_6769 = \"B01001_021\",\n  m_7074 = \"B01001_022\", \n  m_7579 = \"B01001_023\", \n  m_8084 = \"B01001_024\", \n  m_85over = \"B01001_025\",\n  f_6566 = \"B01001_044\", \n  f_6769 = \"B01001_045\", \n  f_7074 = \"B01001_046\", \n  f_7579 = \"B01001_047\", \n  f_8084 = \"B01001_048\", \n  f_85over = \"B01001_049\"\n)\n\ndemo_data <- get_acs(geography = \"tract\",\n  variables = acs_vars,\n  state = \"PA\", survey = \"acs5\", year = 2022, output = \"wide\"\n  ) %>%\n  mutate(over_65E = m_6566E+m_6769E+m_7074E+m_7579E+m_8084E+m_85overE\n         +f_6566E+f_6769E+f_7074E+f_7579E+f_8084E+f_85overE) %>%\n  select(-c(m_6566E,m_6769E,m_7074E,m_7579E,m_8084E,m_85overE,\n         f_6566E,f_6769E,f_7074E,f_7579E,f_8084E,f_85overE,\n         m_6566M,m_6769M,m_7074M,m_7579M,m_8084M,m_85overM,\n         f_6566M,f_6769M,f_7074M,f_7579M,f_8084M,f_85overM))\n# %>%\n#   mutate(NAME = str_extract(NAME, \"Census Tract [0-9.]+\"))\n\n#wasn't joining because there was one census tract difference --> check what's in demo_data but not \n#census_tracts --> one census with total pop of 0 --> get rid of and then join again\ndiff <- setdiff(demo_data$GEOID, census_tracts$GEOID)\ndiff_row <- which(demo_data$GEOID == diff)\ndemo_data <- demo_data[-diff_row,]\n\n# Join to tract boundaries\n# tracts_demodata <- census_tracts %>%\n#   left_join(demo_data %>% select(total_popE, total_popM, med_HH_incomeE, med_HH_incomeM, over_65E), \n#             by = \"GEOID\")\ntracts_demodata <- census_tracts %>%\n  left_join(demo_data %>% select(-c(NAME)), \n            by = \"GEOID\")\n\n#how many tracts have missing income data\nmissing_income_count <- tracts_demodata %>%\n  count(is.na(med_HH_incomeE))\nmissing_income_tracts <- tracts_demodata %>% filter(is.na(med_HH_incomeE))\n\n#calculate mean of all median incomes\nall_med_inc <- mean(tracts_demodata$med_HH_incomeE, na.rm = TRUE)\n```\n:::\n\n\n**Questions to answer:**\n- What year of ACS data are you using? **2022**\n- How many tracts have missing income data? **62**\n- What is the median income across all PA census tracts? **$77527.23**\n\n---\n\n#### Step 3: Define Vulnerable Populations \n\nIdentify census tracts with vulnerable populations based on TWO criteria:\n1. Low median household income (choose an appropriate threshold)\n2. Significant elderly population (choose an appropriate threshold)\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for vulnerable tracts based on your criteria\n\n#taking out rows with missing median income data\nmissing_inc_rows <- which(is.na(tracts_demodata$med_HH_incomeE))\navail_inc_data <- tracts_demodata[-missing_inc_rows,]\n\n# 1. chose <60K as low median HH income\n# 2. adding column of percentage of elderly population --> chose 17% as sig\n# elderly pop threshold\navail_inc_data <- avail_inc_data %>%\n  mutate(elderly_per = over_65E/total_popE*100)\n\n#filter out vulnerable tracts\nvul_pop <- avail_inc_data %>% filter(med_HH_incomeE < 60000 & elderly_per >= 17)\n\n#percent of PA CT that are vulnerable\nPA_per_vul <- nrow(vul_pop)/nrow(census_tracts)*100\n```\n:::\n\n\n**Questions to answer:**\n- What income threshold did you choose and why? **$60,000 because ____**\n- What elderly population threshold did you choose and why? **17% because the national proportion for population over 65 is around 16.85%**\n- How many tracts meet your vulnerability criteria? **574**\n- What percentage of PA census tracts are considered vulnerable by your definition? **16.67%*\n\n---\n\n#### Step 4: Calculate Distance to Hospitals \n\nFor each vulnerable tract, calculate the distance to the nearest hospital.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transform to appropriate projected CRS\nst_crs(vul_pop)\n# in WGS 84\n\n# Calculate distance from each tract centroid to nearest hospital\nvul_tract_centroid <- st_centroid(vul_pop)\n\nnearest_index <- st_nearest_feature(vul_tract_centroid, hospitals)\n\nnearest_dist <- st_distance(vul_tract_centroid, hospitals[nearest_index,],\n                            by_element = TRUE)\n\nvul_pop$nearest_hosp <- as.numeric(nearest_dist/1609.344) #make it in km's\n\n# avg distance to hospitals for all vulnerable tracts\navg_hosp_dist <- mean(vul_pop$nearest_hosp, na.rm = TRUE)\n\n# maximum distance\nmax_dist <- vul_pop %>% slice_max(nearest_hosp, n=1)\n\n# >15 miles\nmore_15 <- vul_pop %>% filter(nearest_hosp > 15)\nnrow(more_15)\n```\n:::\n\n\n**Requirements:**\n- Use an appropriate projected coordinate system for Pennsylvania\n- Calculate distances in miles\n- Explain why you chose your projection\n\n**Questions to answer:**\n- What is the average distance to the nearest hospital for vulnerable tracts? **4.94 miles**\n- What is the maximum distance? **29.06 miles**\n- How many vulnerable tracts are more than 15 miles from the nearest hospital? **34 tracts**\n\n---\n\n#### Step 5: Identify Underserved Areas \n\nDefine \"underserved\" as vulnerable tracts that are more than 15 miles from the nearest hospital.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create underserved variable\nunderserved <- more_15\n\n#how many\nnrow(more_15)\n\n#per_underserved\nper_und <- nrow(underserved)/nrow(vul_pop)*100\n```\n:::\n\n\n**Questions to answer:**\n- How many tracts are underserved? **34 tracts**\n- What percentage of vulnerable tracts are underserved? **5.92% of vulnerable tracts are underserved**\n- Does this surprise you? Why or why not? **This surprises me a little bit, as it was quite low and I assumed tracts with vulnerable populations would be generally underserved in most aspects, as one of the criteria was low income. However, I see that this may happen because despite the low income, counties and local governments might have prepared ahead for the vulnerable populations, knowing they would need the hospitals more.**\n\n---\n\n#### Step 6: Aggregate to County Level\n\nUse spatial joins and aggregation to calculate county-level statistics about vulnerable populations and hospital access.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n#add underserved status to vul_pop\nvul_pop <- vul_pop %>% \n  mutate(underserved = case_when(nearest_hosp > 15 ~ 'Underserved',\n                                   TRUE ~ 'Appropriately Served'))\nvul_pop <- st_transform(vul_pop, st_crs(hospitals))\n#hospital buffer of 15 miles\nhospital_service_areas <- hospitals %>%\n  st_buffer(dist = 24140)\nhospital_service_areas <- st_transform(hospital_service_areas, st_crs(hospitals))\ncombined_service_area <- hospital_service_areas %>%\n  st_union() %>%\n  st_make_valid()\n\n#outside hospital service area\noutside_hosp <- st_difference(pa_counties, combined_service_area)\n\n# ggplot() +\n#   geom_sf(data = pa_counties, fill = \"grey\", color = \"gray\") +\n#   geom_sf(data = outside_hosp, fill = \"lightblue\", alpha = 0.4) +\n#   geom_sf(data = hospitals, color = \"red\", size = 2) +\n#   labs(\n#     title = paste(\"outside hospital service area\"),\n#     subtitle = \"Red points = Hospitals, Blue areas = 15-mile service zones\"\n#   ) +\n#   theme_void()\n\n#ppl living outside hospital service area\npop_summary <- vul_pop %>%\n  st_join(outside_hosp %>% select(COUNTY_NAM)) %>%\n  st_drop_geometry() %>%\n  group_by(COUNTY_NAM) %>%\n  summarize(\n    pop_outHosp = sum(total_popE, na.rm = TRUE),\n    .groups = \"drop\"\n  )\npop_outside_hosp <- pa_counties %>%\n  select(COUNTY_NAM) %>%\n  st_drop_geometry() %>%\n  left_join(pop_summary, by = \"COUNTY_NAM\") %>%\n  mutate(\n    pop_outHosp = coalesce(pop_outHosp, 0)\n  )\n\n# #ppl over 65 living outside hospital service area\nover65_summary <- vul_pop %>%\n  st_join(outside_hosp %>% select(COUNTY_NAM)) %>%\n  st_drop_geometry() %>%\n  group_by(COUNTY_NAM) %>%\n  summarize(\n    total_vul_pop = sum(over_65E, na.rm = TRUE),\n    .groups = \"drop\"\n  )\nover65_outside_hosp <- pa_counties %>%\n  select(COUNTY_NAM) %>%\n  st_drop_geometry() %>%\n  left_join(over65_summary, by = \"COUNTY_NAM\") %>%\n  mutate(\n    total_vul_pop = coalesce(total_vul_pop, 0)\n  )\n\n# Spatial join tracts to counties\ntracts_by_county <- vul_pop %>%\n  st_join(pa_counties %>% select(COUNTY_NAM)) %>%\n  st_drop_geometry() %>%\n  group_by(COUNTY_NAM) %>%\n  summarize(\n    tot_pop = sum(total_popE),\n    n_tracts = n_distinct(GEOID),\n    tract_ids = paste(unique(NAMELSAD), collapse = \", \"),\n    n_underserved = sum(underserved == \"Underserved\"),\n    avg_hosp_dist = mean(nearest_hosp),\n  ) %>%\n  arrange(desc(n_tracts))\n\n# Aggregate statistics by county\n\n# percent of vul tracts that are underserved\n#total\n34/574*100\n#per county\ntracts_by_county <- tracts_by_county %>%\n  mutate(per_underserved = n_underserved/n_tracts*100)\n\n# total vul pop in PA\nsum(vul_pop$total_popE)\n\n# top 5 counties w highest percentage of underserved vul tracts\nhighest_per_und_vul <- tracts_by_county %>% slice_max(per_underserved, n=5)\nhighest_per_und_vul_10 <- tracts_by_county %>% slice_max(per_underserved, n=10)\n\n# counties w the most vul ppl living far from hospitals\ntracts_by_county <- tracts_by_county %>% left_join(pop_outside_hosp, by = \"COUNTY_NAM\")\n# tracts_by_county <- tracts_by_county %>% left_join(over65_outside_hosp, by = \"COUNTY_NAM\")\nmost_vul <- tracts_by_county %>% arrange(desc(pop_outHosp))\n```\n:::\n\n\n**Required county-level statistics:**\n- Number of vulnerable tracts **574 vulnerable tracts**\n- Number of underserved tracts  **34 underserved tracts**\n- Percentage of vulnerable tracts that are underserved  **5.92% are underserved**\n- Average distance to nearest hospital for vulnerable tracts  **4.94 miles**\n- Total vulnerable population in PA **1802220**\n\n**Questions to answer:**\n- Which 5 counties have the highest percentage of underserved vulnerable tracts?\n- Which counties have the most vulnerable people living far from hospitals?\n- Are there any patterns in where underserved counties are located? **For high proportion of underserved tracts, it makes sense that most of the counties are smaller ones, with small total number of tracts. For counties with the most vulnerable people living far from hospitals, it makes sense that it would be slightly bigger counties, where people are more spread apart.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(highest_per_und_vul[, c(1,3,5,7)], \"simple\", \n      col.names = c(\"County Name\", \"# of Tracts\", \"# of Underserved Tracts\", \n                    \"% of Underserved Tracts\"), \n      caption = \"Which 5 counties have the highest percentage of underserved vulnerable tracts?\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Which 5 counties have the highest percentage of underserved vulnerable tracts?\n\nCounty Name    # of Tracts   # of Underserved Tracts   % of Underserved Tracts\n------------  ------------  ------------------------  ------------------------\nCHESTER                  2                         2                       100\nPERRY                    2                         2                       100\nSULLIVAN                 4                         3                        75\nCAMERON                  5                         3                        60\nWYOMING                  2                         1                        50\n\n\n:::\n\n```{.r .cell-code}\nkable(most_vul[, c(1,8,2, 3,5,7,6)], \"simple\", \n      col.names = c(\"County Name\", \"Population >15 miles of Hospitals\", \"Total Population\", \n                    \"# of Tracts\", \"# of Underserved Tracts\", \"% of Underserved Tracts\",\n                    \"Average Distance to Hospitals\"), \n      caption = \"Which counties have the most vulnerable people living far from hospitals?\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Which counties have the most vulnerable people living far from hospitals?\n\nCounty Name       Population >15 miles of Hospitals   Total Population   # of Tracts   # of Underserved Tracts   % of Underserved Tracts   Average Distance to Hospitals\n---------------  ----------------------------------  -----------------  ------------  ------------------------  ------------------------  ------------------------------\nCLEARFIELD                                    43768              68766            19                         8                 42.105263                      12.4081771\nPOTTER                                        26155              34726            11                         4                 36.363636                      11.6764763\nARMSTRONG                                     24002              49547            15                         1                  6.666667                       9.4372737\nTIOGA                                         21444              38118            10                         3                 30.000000                      10.7140760\nBRADFORD                                      17895              38067            10                         3                 30.000000                      11.1379861\nCLARION                                       17556              41135            13                         2                 15.384615                      10.2108888\nBEDFORD                                       16699              46941            13                         1                  7.692308                       9.9544813\nELK                                           12347              31332            10                         4                 40.000000                      12.4208411\nCENTRE                                        11192              14433             4                         1                 25.000000                      13.1074563\nMIFFLIN                                       11158              30041            10                         1                 10.000000                       9.0377807\nLYCOMING                                      10326              46037            12                         1                  8.333333                       6.3662169\nWARREN                                        10287              35229            11                         2                 18.181818                       7.8595061\nCAMERON                                        9910              11467             5                         3                 60.000000                      15.7720394\nCHESTER                                        9859               9859             2                         2                100.000000                      21.4548423\nHUNTINGDON                                     9770              39896            11                         1                  9.090909                      10.0597386\nMCKEAN                                         9477              25483            10                         1                 10.000000                       9.7918995\nJUNIATA                                        8600              12340             4                         1                 25.000000                      11.4765289\nFOREST                                         8582              13270             5                         2                 40.000000                      13.1445039\nCRAWFORD                                       8337              42157            13                         2                 15.384615                       6.9826609\nFULTON                                         8061              12883             4                         0                  0.000000                      10.0509533\nWYOMING                                        7984               7984             2                         1                 50.000000                      18.7004949\nSULLIVAN                                       7766              11676             4                         3                 75.000000                      19.8950644\nSOMERSET                                       7631              73998            20                         1                  5.000000                       7.6192410\nCOLUMBIA                                       6338              16917             5                         1                 20.000000                       7.3457774\nSNYDER                                         5847              12246             3                         1                 33.333333                      12.3849397\nERIE                                           5815              48523            14                         2                 14.285714                       4.2480374\nPERRY                                          5800               5800             2                         2                100.000000                      17.5551908\nCLINTON                                        5724              17194             5                         2                 40.000000                      11.7694914\nVENANGO                                        4684              46359            16                         1                  6.250000                       7.8399110\nMERCER                                         4684              36410            12                         0                  0.000000                       3.6181024\nPIKE                                           4419              11301             5                         2                 40.000000                      14.3310500\nWAYNE                                          4155              27940            11                         2                 18.181818                       9.0944780\nLANCASTER                                      4135              24349             6                         1                 16.666667                       8.4634847\nNORTHUMBERLAND                                 4018              45555            14                         1                  7.142857                      10.3628216\nDAUPHIN                                        4018              21553             6                         1                 16.666667                       5.0769104\nBUTLER                                         3457              20504             6                         0                  0.000000                       6.1528363\nMONROE                                         3222              17814             7                         2                 28.571429                       7.8351757\nSUSQUEHANNA                                    2770              17175             6                         0                  0.000000                       6.2452393\nFAYETTE                                        2138              80604            26                         0                  0.000000                       5.6397156\nFRANKLIN                                       1782              27834             7                         1                 14.285714                       3.7903890\nLUZERNE                                         918              69884            23                         1                  4.347826                       4.4826659\nALLEGHENY                                         0             240251            89                         0                  0.000000                       2.5217422\nPHILADELPHIA                                      0             214680            54                         0                  0.000000                       1.1988649\nWESTMORELAND                                      0             125411            45                         0                  0.000000                       4.0749669\nCAMBRIA                                           0              70339            25                         0                  0.000000                       5.8635941\nLACKAWANNA                                        0              60528            21                         1                  4.761905                       3.5336646\nBEAVER                                            0              43017            18                         0                  0.000000                       3.6778290\nWASHINGTON                                        0              42123            16                         0                  0.000000                       5.2466567\nINDIANA                                           0              51398            15                         1                  6.666667                       8.5408979\nMONTGOMERY                                        0              64651            15                         0                  0.000000                       1.5956215\nDELAWARE                                          0              41086            14                         0                  0.000000                       1.3205300\nJEFFERSON                                         0              48421            14                         3                 21.428571                       7.1570702\nBLAIR                                             0              37533            13                         0                  0.000000                       5.2396095\nSCHUYLKILL                                        0              28231            10                         0                  0.000000                       4.7552457\nLAWRENCE                                          0              23267             9                         0                  0.000000                       3.7203412\nYORK                                              0              27860             9                         0                  0.000000                       1.8255643\nLEHIGH                                            0              29629             8                         0                  0.000000                       2.5973411\nNORTHAMPTON                                       0              27929             8                         0                  0.000000                       4.3091026\nBERKS                                             0              21520             7                         0                  0.000000                       5.0556084\nUNION                                             0              27687             6                         1                 16.666667                       5.7454115\nCARBON                                            0              17838             5                         0                  0.000000                       5.9278555\nLEBANON                                           0              11420             3                         0                  0.000000                       4.2112314\nMONTOUR                                           0              13033             3                         0                  0.000000                       4.4809895\nCUMBERLAND                                        0               6796             2                         0                  0.000000                       1.6419706\nGREENE                                            0               9495             2                         0                  0.000000                      10.5464881\nADAMS                                             0               3908             1                         0                  0.000000                       0.1890303\n\n\n:::\n:::\n\n---\n\n#### Step 7: Create Summary Table \n\nCreate a professional table showing the top 10 priority counties for healthcare investment.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create and format priority counties table\nkable(highest_per_und_vul_10[, c(1,2,3,5,7,6)], \"simple\", \n      col.names = c(\"County Name\",\"Total Population\", \"# of Tracts\", \"# of Underserved Tracts\", \n                    \"% of Underserved Tracts\", \"Average Distance to Hospitals\"), \n      caption = \"Top 10 priority counties for healthcare investment\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Top 10 priority counties for healthcare investment\n\nCounty Name    Total Population   # of Tracts   # of Underserved Tracts   % of Underserved Tracts   Average Distance to Hospitals\n------------  -----------------  ------------  ------------------------  ------------------------  ------------------------------\nCHESTER                    9859             2                         2                 100.00000                        21.45484\nPERRY                      5800             2                         2                 100.00000                        17.55519\nSULLIVAN                  11676             4                         3                  75.00000                        19.89506\nCAMERON                   11467             5                         3                  60.00000                        15.77204\nWYOMING                    7984             2                         1                  50.00000                        18.70049\nCLEARFIELD                68766            19                         8                  42.10526                        12.40818\nELK                       31332            10                         4                  40.00000                        12.42084\nCLINTON                   17194             5                         2                  40.00000                        11.76949\nFOREST                    13270             5                         2                  40.00000                        13.14450\nPIKE                      11301             5                         2                  40.00000                        14.33105\n\n\n:::\n:::\n\n---\n\n## Part 2: Comprehensive Visualization \n\nUsing the skills from Week 3 (Data Visualization), create publication-quality maps and charts.\n\n### Map 1: County-Level Choropleth \n\nCreate a choropleth map showing healthcare access challenges at the county level.\n\n**Your Task:**\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lab2_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n---\n\n### Map 2: Detailed Vulnerability Map \n\nCreate a map highlighting underserved vulnerable tracts.\n\n**Your Task:**\n\n::: {.cell}\n::: {.cell-output-display}\n![](lab2_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n---\n\n### Chart: Distribution Analysis\n\nCreate a visualization showing the distribution of distances to hospitals for vulnerable populations.\n\n**Your Task:**\n\n::: {.cell}\n::: {.cell-output-display}\n![](lab2_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n---\n\n## Part 3: Bring Your Own Data Analysis \n\nChoose your own additional spatial dataset and conduct a supplementary analysis.\n\n### Your Analysis\n\n**Your Task:**\n\n1. **Find and load additional data**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load your additional dataset\nod_deaths <- st_read(here(\"labs/lab_2/data/Estimated Drug Overdose Deaths CY 2012-Current County Health_20260223.shp\"))\nems_stations <- st_read(here(\"labs/lab_2/data/Fire_and_Emergency_Medical_Service__EMS__Stations_pt.shp\"))\n\nod_deaths <- st_transform(od_deaths, st_crs(hospitals))\nems_stations <- st_transform(ems_stations, st_crs(hospitals))\n```\n:::\n\n\n**Questions to answer:**\n- What dataset did you choose and why? **Estimated Drug Overdose Deaths, because I wanted to examine whether there is a correlative relationship between vulnerable populations and the opioids crisis.**\n- What is the data source and date? **PA Open Data, and the data's year ranges from 2012-2024.**\n- How many features does it contain? **884 data points**\n- What CRS is it in? Did you need to transform it? **WGS 84, transformed just in case**\n\n---\n\n2. **Pose a research question**\n\n**Are there more opioid overdoses in vulnerable areas?**\n\n---\n\n3. **Conduct spatial analysis**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your spatial analysis\n\n# ems station buffer\nems_buffer <- ems_stations %>%\n  st_buffer(dist = 10000)\nems_buffer <- st_transform(ems_buffer, st_crs(hospitals))\ncombined_ems_buffer <- ems_buffer %>%\n  st_union() %>%\n  st_make_valid()\n\n# capitalize county names\nod_deaths$county <- toupper(od_deaths$county)\n\n#summarize od deaths by county\nod_by_county <- od_deaths %>%\n  filter(year == 2024) %>%\n  st_join(pa_counties %>% select(COUNTY_NAM)) %>%\n  st_drop_geometry() %>%\n  group_by(COUNTY_NAM) %>%\n  summarize(\n    n_od_2024 = sum(count, na.rm = TRUE)\n  )\n\n#join od deaths to counties\ntracts_by_county <- tracts_by_county %>% left_join(od_by_county, by = \"COUNTY_NAM\")\n\n#percentage of vulnerable ppl of total pop & od deaths:vulnerable ppl ratio\ntracts_by_county <- tracts_by_county %>%\n  mutate(od_vul_ratio = n_od_2024/tot_pop*100)\ntracts_by_county$od_vul_ratio[is.infinite(tracts_by_county$od_vul_ratio)] <- 0\ntracts_by_county$od_vul_ratio[is.nan(tracts_by_county$od_vul_ratio)] <- 0\n```\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: Top 10 priority counties for healthcare investment\n\nCounty Name     Total Vulnerable Population   # of OD in 2024   # of OD to Vulnerable Population Ratio   % Underserved Tracts  Geometry                       \n-------------  ----------------------------  ----------------  ---------------------------------------  ---------------------  -------------------------------\nCHESTER                                9859                66                                0.6694391              100.00000  MULTIPOLYGON (((-76.1449 39... \nPHILADELPHIA                         214680              1058                                0.4928265                0.00000  MULTIPOLYGON (((-75.24449 3... \nBERKS                                 21520                92                                0.4275093                0.00000  MULTIPOLYGON (((-75.79751 4... \nCUMBERLAND                             6796                26                                0.3825780                0.00000  MULTIPOLYGON (((-77.53248 4... \nLEHIGH                                29629               111                                0.3746330                0.00000  MULTIPOLYGON (((-75.62235 4... \nDELAWARE                              41086               115                                0.2799007                0.00000  MULTIPOLYGON (((-75.40325 3... \nYORK                                  27860                77                                0.2763819                0.00000  MULTIPOLYGON (((-76.83294 4... \nDAUPHIN                               21553                56                                0.2598246               16.66667  MULTIPOLYGON (((-76.89093 4... \nBUTLER                                20504                46                                0.2243465                0.00000  MULTIPOLYGON (((-79.89613 4... \nMONROE                                17814                38                                0.2133154               28.57143  MULTIPOLYGON (((-75.51463 4... \n\n\n:::\n\n::: {.cell-output-display}\n![](lab2_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n**Your interpretation:**\n\nIt seems that there isn't that clear of a relationship. Further analysis seems to be needed. Many of the top 10 counties with high OD deaths to total population seems to have 0 underserved tracts in the whole county. But maybe this could be exptected given that counties with a bigger opioid crisis might keep the county better prepped. There doesn't seem to be a large correlation with population either. The map seems to show that the majority of OD's seem to be concentrated in counties with large populations, such as Philadelphia. This is also to be expected. Maybe further analyses without the outliers may help.\n\n",
    "supporting": [
      "lab2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}