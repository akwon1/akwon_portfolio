area_comparison %>% select(COUNTY_NAM, error_geographic_pct),
by = "COUNTY_NAM"
)
# Map the error
ggplot(counties_with_errors) +
geom_sf(aes(fill = error_geographic_pct), color = "white") +
scale_fill_viridis_c(
name = "Area\nError %",
option = "magma"
) +
labs(
title = "Area Calculation Errors by County",
subtitle = "Using geographic coordinates (WGS84) instead of projected CRS"
) +
theme_void()
# Your code here!
View(area_comparison)
#| eval: false
#| echo: true
challenge_data <- get_acs(
geography = "county",
state = "PA",
variables = c(
home_value = "B25077_001",      # YOUR TARGET
total_pop = "B01003_001",       # Total population
median_income = "B19013_001",   # Median household income
median_age = "B01002_001",      # Median age
percent_college = "B15003_022", # Bachelor's degree or higher
median_rent = "B25058_001",     # Median rent
poverty_rate = "B17001_002"     # Population in poverty
),
year = 2022,
output = "wide"
)
# challenge_model <- lm(home_value ~ total_popE + percent_collegeE + poverty_rateE,
#              data = challenge_data)
challenge_model <- lm(home_value ~ total_popE,
data = challenge_data)
#| eval: false
#| echo: true
challenge_data <- get_acs(
geography = "county",
state = "PA",
variables = c(
home_value = "B25077_001",      # YOUR TARGET
total_pop = "B01003_001",       # Total population
median_income = "B19013_001",   # Median household income
median_age = "B01002_001",      # Median age
percent_college = "B15003_022", # Bachelor's degree or higher
median_rent = "B25058_001",     # Median rent
poverty_rate = "B17001_002"     # Population in poverty
),
year = 2022,
output = "wide"
)
# challenge_model <- lm(home_value ~ total_popE + percent_collegeE + poverty_rateE,
#              data = challenge_data)
challenge_model <- lm(home_value ~ total_popE,
data = challenge_data)
View(challenge_data)
# challenge_model <- lm(home_value ~ total_popE + percent_collegeE + poverty_rateE,
#              data = challenge_data)
challenge_model <- lm(home_value ~ total_pop,
data = challenge_data)
# challenge_model <- lm(home_value ~ total_popE + percent_collegeE + poverty_rateE,
#              data = challenge_data)
challenge_model <- lm(home_valueE ~ total_popE,
data = challenge_data)
challenge_model
# challenge_model <- lm(home_value ~ total_popE + percent_collegeE + poverty_rateE,
#              data = challenge_data)
challenge_model <- lm(home_valueE ~ percent_collegeE,
data = challenge_data)
challenge_model
summary(challenge_data)
ggplot(pa_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
# challenge_model <- lm(home_value ~ total_popE + percent_collegeE + poverty_rateE,
#              data = challenge_data)
challenge_model <- lm(home_valueE ~ percent_collegeE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
# percent_college as predictor
challenge_model <- lm(home_valueE ~ percent_collegeE,
data = challenge_data)
na.omit(challenge_data)
challenge_data <- na.omit(challenge_data)
challenge_data
View(challenge_data)
#| eval: false
#| echo: true
challenge_data <- get_acs(
geography = "county",
state = "PA",
variables = c(
home_value = "B25077_001",      # YOUR TARGET
total_pop = "B01003_001",       # Total population
median_income = "B19013_001",   # Median household income
median_age = "B01002_001",      # Median age
percent_college = "B15003_022", # Bachelor's degree or higher
median_rent = "B25058_001",     # Median rent
poverty_rate = "B17001_002"     # Population in poverty
),
year = 2022,
output = "wide"
)
# percent_college as predictor
challenge_model <- lm(home_valueE ~ percent_collegeE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
#median_income as predictor
challenge_model2 <- lm(home_valueE ~ median_income,
data = challenge_data)
#median_income as predictor
challenge_model2 <- lm(home_valueE ~ median_incomeE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model2), y = residuals(challenge_model2))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
#median_income as predictor
ggplot(challenge_data, aes(x = percent_collegeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Percent with Bachelors or higher and home value",
x = "Percent with Bachelors or higher",
y = "Home value"
)
# percent_college as predictor
ggplot(challenge_data, aes(x = percent_collegeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Percent with Bachelors or higher and home value",
x = "Percent with Bachelors or higher",
y = "Home value"
)
#median_income as predictor
ggplot(challenge_data, aes(x = median_incomeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Median income and home value",
x = "Median income",
y = "Home value"
)
ggplot(challenge_data, aes(x = fitted(challenge_model2), y = residuals(challenge_model2))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
#median_rent as predictor
ggplot(challenge_data, aes(x = median_rentE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Median rent and home value",
x = "Median rent",
y = "Home value"
)
challenge_model3 <- lm(home_valueE ~ median_rentE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model3), y = residuals(challenge_model3))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
# percent_college as predictor
ggplot(challenge_data, aes(x = percent_collegeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Percent with Bachelors or higher and home value",
x = "Percent with Bachelors or higher",
y = "Home value"
)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point()x +
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
# percent_college as predictor
ggplot(challenge_data, aes(x = percent_collegeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Percent with Bachelors or higher and home value",
x = "Percent with Bachelors or higher",
y = "Home value"
)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
car
#| echo: true
#| eval: false
library(car)
#median_income as predictor
ggplot(challenge_data, aes(x = median_incomeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Median income and home value",
x = "Median income",
y = "Home value"
)
vif(challenge_model)
# percent_college as predictor
ggplot(challenge_data, aes(x = percent_collegeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Percent with Bachelors or higher and home value",
x = "Percent with Bachelors or higher",
y = "Home value"
)
challenge_model <- lm(home_valueE ~ percent_collegeE,
data = challenge_data)
vif(challenge_model)
challenge_model <- lm(home_valueE ~ percent_collegeE,
data = challenge_data)
vif(challenge_model)
challenge_model2 <- lm(home_valueE ~ median_incomeE,
data = challenge_data)
vif(challenge_model2)
e
challenge_model3 <- lm(home_valueE ~ median_rentE,
data = challenge_data)
vif(challenge_model3)
# percent_college as predictor
ggplot(challenge_data, aes(x = percent_collegeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Percent with Bachelors or higher and home value",
x = "Percent with Bachelors or higher",
y = "Home value"
)
challenge_model <- lm(home_valueE ~ percent_collegeE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
challenge_model <- lm(home_valueE ~ percent_collegeE - poverty_rateE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
challenge_model <- lm(home_valueE ~ percent_collegeE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
#median_rent as predictor
ggplot(challenge_data, aes(x = median_rentE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Median rent and home value",
x = "Median rent",
y = "Home value"
)
ggplot(challenge_data, aes(x = fitted(challenge_model3), y = residuals(challenge_model3))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
# percent_college + median_rent as predictor
challenge_model4 <- lm(home_valueE ~ percent_collegeE + median_rentE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model4), y = residuals(challenge_model4))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
summary(challenge_model4)
summary(challenge_model)
summary(challenge_model3)
summary(challenge_model4)
summary(challenge_model2)
# percent_college + median_rent as predictor
challenge_model4 <- lm(home_valueE ~ percent_collegeE + median_incomeE),
# percent_college + median_rent as predictor
challenge_model4 <- lm(home_valueE ~ percent_collegeE + median_incomeE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model4), y = residuals(challenge_model4))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
summary(challenge_model4)
challenge5 <- lm(home_valueE ~ total_popE + median_incomeE,
data = challenege_data)
challenge5 <- lm(home_valueE ~ total_popE + median_incomeE,
data = challenge_data)
vif(challenge5)
summary(challenge5)
ggplot(challenge_data, aes(x = fitted(challenge5), y = residuals(challenge5))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
#percent_college + median_income
challenge6 <- lm(home_valueE ~ percent_collegeE + median_incomeE,
data = challenge_data)
summary(challenge6)
ggplot(challenge_data, aes(x = fitted(challenge5), y = residuals(challenge5))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
ggplot(challenge_data, aes(x = fitted(challenge6), y = residuals(challenge6))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
vif(challenge6)
ggplot(challenge_data, aes(x = fitted(challenge6), y = residuals(challenge6))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
summary(challenge6)
summary(challenge5)
summary(challenge6)
ggplot(challenge_data, aes(x = fitted(challenge6), y = residuals(challenge6))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
ggplot(challenge_data, aes(x = fitted(challenge6), y = residuals(challenge6))) +
stat_qq() +
stat_qq_line(color = "red") +
labs(title = "Q-Q Plot of Residuals",
x = "Theoretical Quantiles",
y = "Sample Quantiles") +
theme_minimal()
ggplot(challenge_data, aes(sample = residuals)) +
stat_qq() +
stat_qq_line(color = "red") +
labs(title = "Q-Q Plot of Residuals",
x = "Theoretical Quantiles",
y = "Sample Quantiles") +
theme_minimal()
ggplot(challenge_data, aes(sample = residuals(challenge6))) +
stat_qq() +
stat_qq_line(color = "red") +
labs(title = "Q-Q Plot of Residuals",
x = "Theoretical Quantiles",
y = "Sample Quantiles") +
theme_minimal()
# Add diagnostic measures
challenge_data <- challenge_data %>%
mutate(
cooks_d = cooks.distance(challenge6),
leverage = hatvalues(challenge6),
is_influential = cooks_d > 4/nrow(challenge_data)
)
# Plot Cook's distance
ggplot(challenge_data, aes(x = 1:nrow(challenge_data), y = cooks_d)) +
geom_point(aes(color = is_influential), size = 2) +
geom_hline(yintercept = 4/nrow(challenge_data),
linetype = "dashed", color = "red") +
scale_color_manual(values = c("grey60", "red")) +
labs(title = "Cook's Distance",
x = "Observation", y = "Cook's D") +
theme_minimal() +
theme(legend.position = "none")
# Rule of thumb: Cook's D > 4/n
threshold <- 4/nrow(challenge_data)
influential <- challenge_data %>%
filter(cooks_d > threshold) %>%
select(NAME, percent_collegeE, median_incomeE, cooks_d) %>%
arrange(desc(cooks_d))
head(influential, 2)
head(influential, 5)
challenge_data <- challenge_data %>%
mutate(
prop_collegeE = percent_collegeE/total_popE*100)
prop_collegeE
# percent_college as predictor
ggplot(challenge_data, aes(x = prop_collegeE, y = home_valueE)) +
geom_point(alpha = 0.6, size = 3) +
geom_smooth(method = "lm", se = TRUE, color = "steelblue") +
labs(
title = "Percent with Bachelors or higher and home value",
x = "Percent with Bachelors or higher",
y = "Home value"
)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
challenge_model <- lm(home_valueE ~ prop_collegeE,
data = challenge_data)
ggplot(challenge_data, aes(x = fitted(challenge_model), y = residuals(challenge_model))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
summary(challenge_model)
#prop_college + median_income
challenge6 <- lm(home_valueE ~ prop_collegeE + median_incomeE,
data = challenge_data)
summary(challenge6)
ggplot(challenge_data, aes(x = fitted(challenge6), y = residuals(challenge6))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
vif(challenge6)
ggplot(challenge_data, aes(sample = residuals(challenge6))) +
stat_qq() +
stat_qq_line(color = "red") +
labs(title = "Q-Q Plot of Residuals",
x = "Theoretical Quantiles",
y = "Sample Quantiles") +
theme_minimal()
# Add diagnostic measures
challenge_data <- challenge_data %>%
mutate(
cooks_d = cooks.distance(challenge6),
leverage = hatvalues(challenge6),
is_influential = cooks_d > 4/nrow(challenge_data)
)
# Add diagnostic measures
challenge_data <- challenge_data %>%
mutate(
cooks_d = cooks.distance(challenge6),
leverage = hatvalues(challenge6),
is_influential = cooks_d > 4/nrow(challenge_data)
)
# Plot Cook's distance
ggplot(challenge_data, aes(x = 1:nrow(challenge_data), y = cooks_d)) +
geom_point(aes(color = is_influential), size = 2) +
geom_hline(yintercept = 4/nrow(challenge_data),
linetype = "dashed", color = "red") +
scale_color_manual(values = c("grey60", "red")) +
labs(title = "Cook's Distance",
x = "Observation", y = "Cook's D") +
theme_minimal() +
theme(legend.position = "none")
# Rule of thumb: Cook's D > 4/n
threshold <- 4/nrow(challenge_data)
influential <- challenge_data %>%
filter(cooks_d > threshold) %>%
select(NAME, prop_collegeE, median_incomeE, cooks_d) %>%
arrange(desc(cooks_d))
head(influential, 5)
#cross-validation
train_control <- trainControl(method = "cv", number = 10)
#| echo: true
#| eval: true
library(caret)
#cross-validation
train_control <- trainControl(method = "cv", number = 10)
cv_model <- train(home_valueE ~ prop_collegeE + median_incomeE,
data = challenge_data,
method = "lm",
trControl = train_control)
cv_model$results
cv_model
summary(cv_model)
head(cv_model)
summary(cv_model)
cv_model$results
ggplot(challenge_data, aes(x = fitted(challenge6), y = residuals(challenge6))) +
geom_point() +
geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
labs(title = "Residual Plot", x = "Fitted Values", y = "Residuals") +
theme_minimal()
ggplot(challenge_data, aes(sample = residuals(challenge6))) +
stat_qq() +
stat_qq_line(color = "red") +
labs(title = "Q-Q Plot of Residuals",
x = "Theoretical Quantiles",
y = "Sample Quantiles") +
theme_minimal()
